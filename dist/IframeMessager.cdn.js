(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,n(i.key),i)}}function r(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(t){var r=function(t,r){if("object"!==e(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!==e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===e(r)?r:String(r)}const i=function(){function e(t){var n=t.role,i=t.iframe,o=t.origin,a=t.topEmit;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,"_packs",{}),r(this,"iframe",[]),this.role=n,this.origin=null!=o?o:window.location.origin,this.topEmit=null!=a&&a,"parent"===n&&this.addIframe(i)}var n,i,o;return n=e,o=[{key:"isIframe",value:function(e){return e&&"IFRAME"===e.tagName}}],(i=[{key:"_send",value:function(e,t,r){r.contentWindow.postMessage({type:e,payload:t},this.origin)}},{key:"_createProcessMessageHandler",value:function(e,t){return function(r){var n=r.data;return n.type===e&&t(n.payload)}}},{key:"addIframe",value:function(t){var r;if(e.isIframe(t)&&(r=[t]),r&&r instanceof Array)for(var n=0;n<r.length;n++){var i=r[n];e.isIframe(i)&&this.iframe&&-1===this.iframe.indexOf(i)&&this.iframe.push(i)}}},{key:"on",value:function(e,t){if(e&&t&&t instanceof Function){var r=this._createProcessMessageHandler(e,t);window.addEventListener("message",r);var n=function(){return window.removeEventListener("message",r)},i={type:e,handler:r,removeHandler:n};return this._packs[e]?this._packs[e].push(i):this._packs[e]=[i],n}}},{key:"off",value:function(e){this._packs[e]&&this._packs[e].forEach((function(e){return e.removeHandler()}))}},{key:"emit",value:function(t,r,n){var i=this;if("parent"===this.role){var o=null!=n?n:this.iframe;o&&(e.isIframe(o)&&(o=[o]),o instanceof Array&&o.forEach((function(n){e.isIframe(n)&&i._send(t,r,n)})))}else if("children"===this.role){var a=this.topEmit?"top":"parent";window[a].postMessage({type:t,payload:r},this.origin)}}}])&&t(n.prototype,i),o&&t(n,o),Object.defineProperty(n,"prototype",{writable:!1}),e}();window.IframeMessager=i})();